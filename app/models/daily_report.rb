# == Schema Information
#
# Table name: reports
#
#  id           :bigint           not null, primary key
#  message_time :datetime
#  period       :string           default("daily"), not null
#  created_at   :datetime         not null
#  updated_at   :datetime         not null
#  chat_id      :bigint
#
# Indexes
#
#  index_reports_on_chat_id  (chat_id)
#
class DailyReport < Report
  def render
    scope = message_counters.where(date: (Time.zone.now - 1.day).to_date)
    total = scope.sum(:value)
    top_10 = scope.order(value: :desc).first(10)

    rendered_top = top_10.map.with_index do |c, i|
      "#{i + 1}\\. [#{[c.user.first_name, c.user.last_name].compact.join(" ")}](tg://user?id=#{c.user.telegam_user_id}) \\- *#{c.value}*"
    end.join("\n")

    counter = "ÐÐ°Ð¿Ð¸ÑÐ°Ð½Ð½Ñ‹Ðµ Ð¸ Ð¿Ñ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð·Ð° Ð²Ñ‡ÐµÑ€Ð°: #{total}"

    <<~HEREDOC
      #{hello_frase(total)}

      *#{counter}*

      Ð­Ñ‚Ð¾ Ð²Ð¾Ñ‚ 10 ÑÐ°Ð¼Ñ‹Ñ… Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… :\\)
      #{rendered_top}

      Ð£Ð²Ð¸Ð´Ð¸Ð¼ÑÑ Ð·Ð°Ð²Ñ‚Ñ€Ð° ;\\)
    HEREDOC
  end

  def timeshift
    - 5.hours
  end

  private

  def hello_frase(total)
    return special_hello if total < rand(200..800)

    hello_frases.sample
  end

  def hello_frases
    [
      "Ð”Ð¾Ð±Ñ€Ð¾Ðµ ÑƒÑ‚Ñ€Ð¾, Ð´Ð¾Ñ€Ð¾Ð³Ð¸Ðµ Ñ‡Ð°Ñ‚Ð»Ð°Ð½Ñ‹\\! Ð¡ÐµÐ³Ð¾Ð´Ð½ÑÑˆÐ½Ð¸Ð¹ Ð´ÐµÐ½ÑŒ Ð¾Ð±ÐµÑ‰Ð°ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ñ‚Ð°ÐºÐ¸Ð¼ Ð¶Ðµ Ð²ÐµÑÐµÐ»Ñ‹Ð¼, ÐºÐ°Ðº Ð²Ð°ÑˆÐµ Ð¿ÐµÑ€Ð²Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ\\!",
      "ÐŸÑ€Ð¸Ð²ÐµÑ‚, Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚\\-Ð³ÐµÑ€Ð¾Ð¸\\! Ð“Ð¾Ñ‚Ð¾Ð²Ñ‹ Ð»Ð¸ Ð²Ñ‹ Ðº Ð½Ð¾Ð²Ð¾Ð¼Ñƒ Ð´Ð½ÑŽ, Ð¿Ð¾Ð»Ð½Ð¾Ð¼Ñƒ ÑÐ¼Ð°Ð¹Ð»Ð¸ÐºÐ¾Ð² Ð¸ Ð½ÐµÐ¾Ð¶Ð¸Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¼ÐµÐ¼Ð¾Ð²\\?",
      "Ð”Ð¾Ð±Ñ€ÐµÐ¹ÑˆÐµÐ³Ð¾ Ð´Ð½Ñ, Ð´Ñ€ÑƒÐ·ÑŒÑ\\! ÐŸÑƒÑÑ‚ÑŒ Ð²Ð°ÑˆÐµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ðµ Ð±ÑƒÐ´ÐµÑ‚ Ñ‚Ð°ÐºÐ¸Ð¼ Ð¶Ðµ ÑÑ€ÐºÐ¸Ð¼, ÐºÐ°Ðº ÑÑ‚Ð¾Ñ‚ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¼Ð¸Ñ€\\!",
      "Ð—Ð´Ñ€Ð°Ð²ÑÑ‚Ð²ÑƒÐ¹Ñ‚Ðµ, ÑƒÐ²Ð°Ð¶Ð°ÐµÐ¼Ñ‹Ðµ Ð¼Ð°ÑÑ‚ÐµÑ€Ð° ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ñ‹\\! ÐŸÑƒÑÑ‚ÑŒ ÑÐµÐ³Ð¾Ð´Ð½Ñ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð¸Ð· Ð²Ð°Ñ Ð½Ð°Ð¹Ð´ÐµÑ‚ Ð¿Ð¾Ð²Ð¾Ð´ Ð´Ð»Ñ ÑƒÐ»Ñ‹Ð±ÐºÐ¸\\!",
      "ÐŸÑ€Ð¸Ð²ÐµÑ‚\\-Ð¿Ñ€Ð¸Ð²ÐµÑ‚, Ð·Ð°Ð¼ÐµÑ‡Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð»ÑŽÐ´Ð¸\\! ÐŸÑƒÑÑ‚ÑŒ Ð²Ð°Ñˆ Ð´ÐµÐ½ÑŒ Ð±ÑƒÐ´ÐµÑ‚ Ð¿Ð¾Ð»Ð¾Ð½ ÑÑŽÑ€Ð¿Ñ€Ð¸Ð·Ð¾Ð² Ð¸ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÐ½Ñ‹Ñ… Ñ€Ð°Ð·Ð³Ð¾Ð²Ð¾Ñ€Ð¾Ð²\\!",
      "Ð”Ð¾Ð±Ñ€Ð¾Ðµ ÑƒÑ‚Ñ€Ð¾, Ñ‡Ð°Ñ‚Ð¾Ð²Ñ‹Ðµ ÑÐ½Ñ‚ÑƒÐ·Ð¸Ð°ÑÑ‚Ñ‹\\! ÐŸÑƒÑÑ‚ÑŒ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð²Ð°ÑˆÐ¸ Ð¿Ð°Ð»ÑŒÑ†Ñ‹ Ð±ÑƒÐ´ÑƒÑ‚ Ñ‚Ð°Ðº Ð¶Ðµ Ð±Ñ‹ÑÑ‚Ñ€Ñ‹, ÐºÐ°Ðº Ð²Ð°ÑˆÐ¸ Ð¼Ñ‹ÑÐ»Ð¸\\!",
      "Ð’ÑÐµÐ¼ Ð¿Ñ€Ð¸Ð²ÐµÑ‚\\! ÐÐ°Ð´ÐµÑŽÑÑŒ, Ð²Ð°ÑˆÐµ ÑƒÑ‚Ñ€Ð¾ Ð½Ð°Ñ‡Ð°Ð»Ð¾ÑÑŒ Ñ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¸Ñ… Ð½Ð¾Ð²Ð¾ÑÑ‚ÐµÐ¹ Ð¸ Ð²ÐºÑƒÑÐ½Ð¾Ð³Ð¾ ÐºÐ¾Ñ„Ðµ\\!",
      "Ð”Ð¾Ð±Ñ€Ð¾Ðµ ÑƒÑ‚Ñ€Ð¾, Ñ‡ÑƒÐ´ÐµÑÐ½Ñ‹Ðµ ÑÐ¾Ð±ÐµÑÐµÐ´Ð½Ð¸ÐºÐ¸\\! ÐŸÑƒÑÑ‚ÑŒ ÑÐµÐ³Ð¾Ð´Ð½Ñ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð½Ð°Ð¹Ð´ÐµÑ‚ Ð² Ñ‡Ð°Ñ‚Ðµ Ñ‡Ñ‚Ð¾\\-Ñ‚Ð¾ Ð½Ð¾Ð²Ð¾Ðµ Ð¸ ÑƒÐ´Ð¸Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ\\!",
      "ÐŸÑ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽ, Ð´Ñ€ÑƒÐ·ÑŒÑ\\! ÐŸÑƒÑÑ‚ÑŒ ÑÐµÐ³Ð¾Ð´Ð½ÑÑˆÐ½Ð¸Ð¹ Ð´ÐµÐ½ÑŒ Ð¿Ñ€Ð¸Ð½ÐµÑÐµÑ‚ Ð²Ð°Ð¼ Ð¼Ð°ÑÑÑƒ Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ñ‹Ñ… ÑÐ¼Ð¾Ñ†Ð¸Ð¹ Ð¸ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÐ½Ñ‹Ñ… Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹\\!",
      "Ð—Ð´Ñ€Ð°Ð²ÑÑ‚Ð²ÑƒÐ¹, Ñ‡Ð°Ñ‚\\! Ð“Ð¾Ñ‚Ð¾Ð²Ñ‹ Ð»Ð¸ Ð²Ñ‹ Ðº Ð½Ð¾Ð²Ð¾Ð¼Ñƒ Ð´Ð½ÑŽ, Ð¿Ð¾Ð»Ð½Ð¾Ð¼Ñƒ Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ, ÑÐ¼ÐµÑ…Ð° Ð¸ Ð½ÐµÐ¾Ð¶Ð¸Ð´Ð°Ð½Ð½Ñ‹Ñ… Ñ‚ÐµÐ¼\\?",
      "Ð”Ð¾Ð±Ñ€Ð¾Ð³Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ ÑÑƒÑ‚Ð¾Ðº, ÐºÐ¾Ð»Ð»ÐµÐ³Ð¸\\!",
      "Ð”Ð¾Ð±Ñ€Ð¾Ðµ ÑƒÑ‚Ñ€Ð¾, Ð´Ð¾Ñ€Ð¾Ð³Ð¸Ðµ Ñ‡Ð°Ñ‚Ð»Ð°Ð½Ðµ\\! Ð“Ð¾Ñ‚Ð¾Ð²Ñ‹ Ð»Ð¸ Ð²Ñ‹ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ñ ÑƒÐ»Ñ‹Ð±ÐºÐ¾Ð¹ Ð¸ Ð²ÐµÑÐµÐ»ÑŒÐµÐ¼\\?",
      "ÐŸÑ€Ð¸Ð²ÐµÑ‚\\-Ð¿Ñ€Ð¸Ð²ÐµÑ‚, Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚\\-ÑÑƒÐ¿ÐµÑ€Ð³ÐµÑ€Ð¾Ð¸\\! Ð”Ð°Ð²Ð°Ð¹Ñ‚Ðµ ÑÐµÐ³Ð¾Ð´Ð½Ñ ÑÐ¾Ð·Ð´Ð°Ð´Ð¸Ð¼ ÐµÑ‰Ðµ Ð±Ð¾Ð»ÑŒÑˆÐµ ÑÑ€ÐºÐ¸Ñ… Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ð¾Ð²\\!",
      "Ð”Ð¾Ð±Ñ€ÐµÐ¹ÑˆÐµÐ³Ð¾ Ð´Ð½Ñ Ð²ÑÐµÐ¼\\! ÐŸÑƒÑÑ‚ÑŒ Ð²Ð°Ñˆ Ð´ÐµÐ½ÑŒ Ð±ÑƒÐ´ÐµÑ‚ Ð¿Ð¾Ð»Ð¾Ð½ Ñ€Ð°Ð´Ð¾ÑÑ‚Ð¸ Ð¸ Ð½ÐµÐ¾Ð¶Ð¸Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑÑŽÑ€Ð¿Ñ€Ð¸Ð·Ð¾Ð²\\!",
      "ÐŸÑ€Ð¸Ð²ÐµÑ‚, Ð²ÐµÑÐµÐ»Ñ‹Ðµ ÑÐ¾Ð±ÐµÑÐµÐ´Ð½Ð¸ÐºÐ¸\\! Ð¡ÐµÐ³Ð¾Ð´Ð½Ñ Ñƒ Ð½Ð°Ñ Ð´ÐµÐ½ÑŒ Ð¾Ñ‚Ð»Ð¸Ñ‡Ð½Ð¾Ð³Ð¾ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ñ Ð¸ Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ñ‹Ñ… ÑÐ¼Ð¾Ñ†Ð¸Ð¹\\!",
      "Ð”Ð¾Ð±Ñ€Ð¾Ðµ ÑƒÑ‚Ñ€Ð¾, Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð¸ÑÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸\\! ÐŸÑƒÑÑ‚ÑŒ Ð²Ð°Ñˆ Ð´ÐµÐ½ÑŒ Ð±ÑƒÐ´ÐµÑ‚ Ð¿Ð¾Ð»Ð¾Ð½ ÑƒÐ´Ð¸Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹ Ð¸ Ð²Ð´Ð¾Ñ…Ð½Ð¾Ð²ÐµÐ½Ð¸Ñ\\!",
      "Ð’ÑÐµÐ¼ Ð¿Ñ€Ð¸Ð²ÐµÑ‚\\! ÐÐ°Ñ‡Ð½ÐµÐ¼ Ð´ÐµÐ½ÑŒ Ñ ÑƒÐ»Ñ‹Ð±ÐºÐ¸ Ð¸ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐ³Ð¾ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ñ\\!",
      "Ð”Ð¾Ð±Ñ€Ð¾Ðµ ÑƒÑ‚Ñ€Ð¾, Ñ‡ÑƒÐ´ÐµÑÐ½Ñ‹Ðµ Ñ‡Ð°Ñ‚Ð»Ð°Ð½Ðµ\\! Ð¡ÐµÐ³Ð¾Ð´Ð½Ñ Ð½Ð°Ñ Ð¶Ð´ÐµÑ‚ Ð¼Ð½Ð¾Ð³Ð¾ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÐ½Ñ‹Ñ… Ð±ÐµÑÐµÐ´ Ð¸ Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ñ‹Ñ… ÑÐ¼Ð¾Ñ†Ð¸Ð¹\\!",
      "ÐŸÑ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽ Ð²ÑÐµÑ…\\! ÐŸÑƒÑÑ‚ÑŒ Ð²Ð°Ñˆ Ð´ÐµÐ½ÑŒ Ð±ÑƒÐ´ÐµÑ‚ Ñ‚Ð°ÐºÐ¸Ð¼ Ð¶Ðµ ÑÑ€ÐºÐ¸Ð¼, ÐºÐ°Ðº Ð¸ Ð²Ð°ÑˆÐ¸ Ð¸Ð´ÐµÐ¸\\!",
      "Ð—Ð´Ñ€Ð°Ð²ÑÑ‚Ð²ÑƒÐ¹, Ñ‡Ð°Ñ‚\\! Ð“Ð¾Ñ‚Ð¾Ð²Ñ‹ Ð»Ð¸ Ð²Ñ‹ Ð¿Ñ€Ð¾Ð²ÐµÑÑ‚Ð¸ Ð´ÐµÐ½ÑŒ Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð¹ Ð¸ Ð²ÐµÑÐµÐ»ÑŒÐµÐ¼\\?"
    ]
  end

  def special_hello
    <<~STRING
      ÐŸÑ€Ð¸Ð²ÐµÑ‚,  ÐºÐ¾Ð»Ð»ÐµÐ³Ð¸\\!

      Ð¡Ð¼Ð¾Ñ‚Ñ€ÑŽ, ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð¼Ñ‹ Ð±Ñ‹Ð»Ð¸ Ñ‚Ð°Ðº Ð·Ð°Ð½ÑÑ‚Ñ‹, Ñ‡Ñ‚Ð¾ Ð´Ð°Ð¶Ðµ Ð² Ñ‡Ð°Ñ‚Ðµ Ñ‚Ð¸ÑˆÐ¸Ð½Ð°\\.\\.\\. ÐÐ°Ð²ÐµÑ€Ð½Ð¾Ðµ, Ð²ÑÐµ Ð²Ð·ÑÐ»Ð¸ÑÑŒ Ð·Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ Ñ‚Ð°Ðº ÑƒÑÐµÑ€Ð´Ð½Ð¾, Ñ‡Ñ‚Ð¾ Ð´Ð°Ð¶Ðµ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð½Ð° Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð½Ðµ Ð½Ð°ÑˆÐ»Ð¾ÑÑŒ\\! ðŸ¤” ÐÐ°Ð´ÐµÑŽÑÑŒ, ÑÑ‚Ð¾ Ð¿Ð¾Ñ‚Ð¾Ð¼Ñƒ, Ñ‡Ñ‚Ð¾ Ð¼Ñ‹ Ð²ÑÐµ Ñ€ÐµÑˆÐ¸Ð»Ð¸ ÑÐºÐ¾Ð½Ñ†ÐµÐ½Ñ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒÑÑ Ð¸ Ð²Ð»Ð¾Ð¶Ð¸Ñ‚ÑŒ Ð²ÑÐµ ÑÐ¸Ð»Ñ‹ Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹, Ð° Ð½Ðµ Ð¿Ð¾Ñ‚Ð¾Ð¼Ñƒ, Ñ‡Ñ‚Ð¾ Ð·Ð°Ð±Ñ‹Ð»Ð¸ Ð¿Ð°Ñ€Ð¾Ð»Ð¸ Ð¾Ñ‚ Ñ‡Ð°Ñ‚Ð°\\. ðŸ˜‚ Ð”Ð°Ð²Ð°Ð¹Ñ‚Ðµ ÑÑ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ ÑÐµÐ³Ð¾Ð´Ð½ÑÑˆÐ½Ð¸Ð¹ Ð´ÐµÐ½ÑŒ \\"Ð¼ÐµÐ¶Ð´ÑƒÐ½Ð°Ñ€Ð¾Ð´Ð½Ñ‹Ð¼ Ð´Ð½ÐµÐ¼ Ñ‚Ð¸ÑˆÐ¸Ð½Ñ‹ Ð² Ð¾Ñ„Ð¸ÑÐµ\\" Ð¸ Ð¿Ð¾Ð¾Ð±ÐµÑ‰Ð°ÐµÐ¼ Ð´Ñ€ÑƒÐ³ Ð´Ñ€ÑƒÐ³Ñƒ, Ñ‡Ñ‚Ð¾ Ð·Ð°Ð²Ñ‚Ñ€Ð° Ð±ÑƒÐ´ÐµÐ¼ Ð½Ðµ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ñ‹ Ð² Ñ€Ð°Ð±Ð¾Ñ‚Ðµ, Ð½Ð¾ Ð¸ Ñ‡ÑƒÑ‚ÑŒ Ð±Ð¾Ð»ÐµÐµ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹ Ð² Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¸\\. Ð’ ÐºÐ¾Ð½Ñ†Ðµ ÐºÐ¾Ð½Ñ†Ð¾Ð², Ð²Ð¼ÐµÑÑ‚Ðµ Ð¼Ñ‹ Ð½Ðµ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÑÐ¸Ð»Ð°, Ð½Ð¾ Ð¸ Ð¾Ñ‚Ð»Ð¸Ñ‡Ð½Ð°Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° Ð¾Ð±Ñ‰Ð¸Ñ‚ÐµÐ»ÐµÐ¹\\!

      ÐŸÐ¾Ð´Ð½Ð¸Ð¼Ð¸Ñ‚Ðµ Ñ€ÑƒÐºÑƒ, ÐºÑ‚Ð¾ Ð·Ð° Ñ‚Ð¾, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð·Ð°Ð²Ñ‚Ñ€Ð° ÐºÐ¾Ð¼Ð¿ÐµÐ½ÑÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐµÐ³Ð¾Ð´Ð½ÑÑˆÐ½ÑŽÑŽ Ñ‚Ð¸ÑˆÐ¸Ð½Ñƒ Ð´Ð²Ð¾Ð¹Ð½Ð¾Ð¹ Ð¿Ð¾Ñ€Ñ†Ð¸ÐµÐ¹ ÑˆÑƒÑ‚Ð¾Ðº Ð¸ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¹\\! ðŸ™ŒðŸ˜„
    STRING
  end
end
